{"version":3,"file":"bundle.js","mappings":"SAAA;SACA;;;;;UCDA;UACA;UACA;UACA;UACA,yCAAyC,wCAAwC;UACjF;UACA;UACA;;;;;UCPA;;;;;UCAA;UACA;UACA;UACA,uDAAuD,iBAAiB;UACxE;UACA,gDAAgD,aAAa;UAC7D;;;;;;;;;;;;ACNA,MAAMA,kBAAkB,CAAC;EAGrBC,WAAWA,CAAA,EAAG;IAEV,IAAI,CAACC,QAAQ,GAAG,CAAC,CAAC;IAClB,IAAI,CAACC,WAAW,GAAG,EAAE;IACrB,IAAI,CAACC,WAAW,GAAG,EAAE;IAErB,IAAIC,SAAS,GAAIC,CAAC,IAAK;MACnB;MACA;MACA;MACA;MACAC,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAE,WAAW,EAAEF,CAAC,CAACG,MAAM,EAAEH,CAAC,CAACI,IAAI,CAAC;MAErE,IAAIC,OAAO,GAAGL,CAAC,CAACI,IAAI;MAEpB,IAAIC,OAAO,CAACC,cAAc,CAAC,SAAS,CAAC,IAAID,OAAO,CAACC,cAAc,CAAC,UAAU,CAAC,EAAE;QAAC;QAC1E,IAAI,CAACC,cAAc,CAACF,OAAO,CAAC;MAChC,CAAC,MAAM;QACH,IAAIA,OAAO,CAACC,cAAc,CAAC,SAAS,CAAC,EAAE;UACnC,IAAI,CAACE,aAAa,CAACH,OAAO,CAAC;QAC/B;MACJ;IACJ,CAAC;IAED,IAAII,MAAM,CAACC,gBAAgB,EAAE;MACzBD,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAEX,SAAS,EAAE,KAAK,CAAC;IACxD,CAAC,MAAM,IAAIU,MAAM,CAACE,WAAW,EAAE;MAC3BF,MAAM,CAACE,WAAW,CAAC,WAAW,EAAEZ,SAAS,CAAC;IAC9C;IAEAa,WAAW,CAAC,MAAM;MACd,IAAIC,IAAI,GAAG,IAAIC,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;MAE/B,KAAK,IAAIC,EAAE,IAAI,IAAI,CAACpB,QAAQ,EAAE;QAC1B,IAAI,IAAI,CAACA,QAAQ,CAACU,cAAc,CAACU,EAAE,CAAC,EAAE;UAClC,IAAIC,OAAO,GAAG,IAAI,CAACrB,QAAQ,CAACoB,EAAE,CAAC;UAC/B,IAAIH,IAAI,GAAII,OAAO,CAACJ,IAAI,GAAI,IAAI,CAACf,WAAW,GAAG,IAAM,EAAE;YACnDmB,OAAO,CAAC,UAAU,CAAC,GAAG;cAACC,OAAO,EAAE,KAAK;cAAEC,OAAO,EAAE,CAAC,CAAC;cAAEd,OAAO,EAAE,SAAS;cAAEe,IAAI,EAAE;YAAI,CAAC;YACnFnB,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAEe,OAAO,CAAC;YACxC,IAAI,CAACV,cAAc,CAACU,OAAO,CAAC;UAChC;QACJ;MACJ;IACJ,CAAC,EAAE,IAAI,CAAC;EACZ;EAEAI,KAAKA,CAACC,IAAI,EAAEC,QAAQ,EAAE;IAClB,IAAI,CAAC1B,WAAW,CAAC2B,IAAI,CAAC;MAACF,IAAI,EAAEA,IAAI;MAAEC,QAAQ,EAAEA;IAAQ,CAAC,CAAC;EAC3D;EAEAE,IAAIA,CAAA,EAAG;IACHxB,OAAO,CAACC,GAAG,CAAC,OAAO,EAAE,IAAI,CAAC;IAC1BO,MAAM,CAACiB,MAAM,CAACC,WAAW,CAACC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,SAAS,CAAC,IAAI,CAAC,CAAC,EAAE,GAAG,CAAC;EACpE;EAGAtB,aAAaA,CAACH,OAAO,EAAE;IAEnBJ,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAEG,OAAO,CAAC;IAClD,IAAI0B,QAAQ,GAAG;MAACb,OAAO,EAAE,IAAI;MAAEC,OAAO,EAAE,CAAC;IAAC,CAAC;IAE3Cd,OAAO,CAACoB,IAAI,GAAG,IAAI,CAACA,IAAI;IACxBpB,OAAO,CAAC0B,QAAQ,GAAGA,QAAQ;IAG3B,IAAI;MAEA,KAAK,IAAIC,UAAU,IAAI,IAAI,CAACnC,WAAW,EAAE;QACrC,IAAImC,UAAU,CAACV,IAAI,KAAKjB,OAAO,CAACY,OAAO,CAACK,IAAI,EAAE;UAC1CU,UAAU,CAACT,QAAQ,CAAClB,OAAO,CAAC;QAChC;MACJ;IACJ,CAAC,CAAC,OAAOL,CAAC,EAAE;MACR+B,QAAQ,CAACb,OAAO,GAAG,KAAK;MACxBa,QAAQ,CAACE,KAAK,GAAGjC,CAAC,CAACK,OAAO;IAC9B;IACAA,OAAO,CAAC0B,QAAQ,GAAGA,QAAQ;;IAE3B;EACJ;EAEAxB,cAAcA,CAACF,OAAO,EAAE;IACpBJ,OAAO,CAACC,GAAG,CAAC,sCAAsC,EAAEG,OAAO,CAAC;IAC5D,IAAIA,OAAO,CAACW,EAAE,IAAI,IAAI,CAACpB,QAAQ,CAACU,cAAc,CAACD,OAAO,CAACW,EAAE,CAAC,EAAE;MAExD,IAAIC,OAAO,GAAG,IAAI,CAACrB,QAAQ,CAACS,OAAO,CAACW,EAAE,CAAC;MACvCC,OAAO,CAACM,QAAQ,CAAClB,OAAO,CAAC0B,QAAQ,CAAC;MAClC,OAAO,IAAI,CAACnC,QAAQ,CAACS,OAAO,CAACW,EAAE,CAAC;IACpC,CAAC,MAAM;MACHf,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC;IAClC;EACJ;EAEAgC,WAAWA,CAACC,QAAQ,EACjB;IAAA,IADmBZ,QAAQ,GAAAa,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,MAAM,CACvC,CAAC;IAEG,IAAI;MACA,IAAIpB,EAAE,GAAI,IAAIF,IAAI,CAAC,CAAC,CAAEC,OAAO,CAAC,CAAC;MAE/B,IAAIV,OAAO,GAAG,CAAC,CAAC;MAChBA,OAAO,CAACW,EAAE,GAAGA,EAAE;MACfX,OAAO,CAACkB,QAAQ,GAAGA,QAAQ;MAC3BlB,OAAO,CAACY,OAAO,GAAGkB,QAAQ;MAE1B,IAAI,CAACvC,QAAQ,CAACoB,EAAE,CAAC,GAAGX,OAAO;MAE3BJ,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAEG,OAAO,CAAC;MAChDI,MAAM,CAACiB,MAAM,CAACC,WAAW,CAACC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,SAAS,CAACzB,OAAO,CAAC,CAAC,EAAE,GAAG,CAAC;IAEvE,CAAC,CAAC,OAAOL,CAAC,EAAE;MACRC,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEF,CAAC,CAAC;IAClC;EAEJ;EAEAuC,aAAaA,CAACC,UAAU,EAAEC,eAAe,EAAE;IACvC,OAAO,IAAI,CAACC,OAAO,CAACF,UAAU,CAAC,KAAK,IAAI,CAACE,OAAO,CAACD,eAAe,CAAC;EACrE;EAGAC,OAAOA,CAACC,GAAG,EAAE;IACT,IAAIC,CAAC,GAAGC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;IACnCF,CAAC,CAACG,IAAI,GAAGJ,GAAG;IACZ,OAAOC,CAAC,CAACI,QAAQ;EACrB;AAGJ;AAEA,iEAAetD,kBAAkB,E","sources":["webpack://senler-integration-bot/webpack/bootstrap","webpack://senler-integration-bot/webpack/runtime/define property getters","webpack://senler-integration-bot/webpack/runtime/hasOwnProperty shorthand","webpack://senler-integration-bot/webpack/runtime/make namespace object","webpack://senler-integration-bot/./src/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","class IntegrationConnect {\r\n\r\n\r\n    constructor() {\r\n\r\n        this.requests = {};\r\n        this.subscribers = [];\r\n        this.timeout_sec = 50;\r\n\r\n        let onmessage = (e) => {\r\n            // if (!this.isValidSource(e.origin, this.currIntegration.url_callback)){\r\n            //     alert('Запрос с интеграции не корректен');\r\n            //     return false;\r\n            // }\r\n            console.log('integration .onmessage ', 'e.origin=', e.origin, e.data);\r\n\r\n            let message = e.data;\r\n\r\n            if (message.hasOwnProperty('request') && message.hasOwnProperty('response')) {//full\r\n                this.handleResponse(message);\r\n            } else {\r\n                if (message.hasOwnProperty('request')) {\r\n                    this.handleRequest(message);\r\n                }\r\n            }\r\n        };\r\n\r\n        if (window.addEventListener) {\r\n            window.addEventListener('message', onmessage, false);\r\n        } else if (window.attachEvent) {\r\n            window.attachEvent('onmessage', onmessage);\r\n        }\r\n\r\n        setInterval(() => {\r\n            let time = new Date().getTime();\r\n\r\n            for (let id in this.requests) {\r\n                if (this.requests.hasOwnProperty(id)) {\r\n                    let request = this.requests[id];\r\n                    if (time > (request.time + (this.timeout_sec * 1000))) {\r\n                        request['response'] = {success: false, payload: {}, message: \"timeout\", code: 1000};\r\n                        console.log('timeout request=', request);\r\n                        this.handleResponse(request);\r\n                    }\r\n                }\r\n            }\r\n        }, 5000);\r\n    }\r\n\r\n    route(type, callback) {\r\n        this.subscribers.push({type: type, callback: callback});\r\n    }\r\n\r\n    send() {\r\n        console.log('.send', this);\r\n        window.parent.postMessage(JSON.parse(JSON.stringify(this)), '*');\r\n    }\r\n\r\n\r\n    handleRequest(message) {\r\n\r\n        console.log('integration .handleRequest', message);\r\n        let response = {success: true, payload: {}};\r\n\r\n        message.send = this.send;\r\n        message.response = response;\r\n\r\n\r\n        try {\r\n\r\n            for (let subscriber of this.subscribers) {\r\n                if (subscriber.type === message.request.type) {\r\n                    subscriber.callback(message);\r\n                }\r\n            }\r\n        } catch (e) {\r\n            response.success = false;\r\n            response.error = e.message;\r\n        }\r\n        message.response = response;\r\n\r\n        // window.parent.postMessage(JSON.parse(JSON.stringify(message)), '*');\r\n    }\r\n\r\n    handleResponse(message) {\r\n        console.log('integration .handleResponse message=', message);\r\n        if (message.id && this.requests.hasOwnProperty(message.id)) {\r\n\r\n            let request = this.requests[message.id];\r\n            request.callback(message.response);\r\n            delete this.requests[message.id];\r\n        } else {\r\n            console.log('.handleResponse');\r\n        }\r\n    }\r\n\r\n    sendRequest(_message, callback = () => {\r\n    }) {\r\n\r\n        try {\r\n            let id = (new Date()).getTime();\r\n\r\n            let message = {};\r\n            message.id = id;\r\n            message.callback = callback;\r\n            message.request = _message;\r\n\r\n            this.requests[id] = message;\r\n\r\n            console.log('integration sendRequest ', message);\r\n            window.parent.postMessage(JSON.parse(JSON.stringify(message)), '*');\r\n\r\n        } catch (e) {\r\n            console.log('.sendRequest', e);\r\n        }\r\n\r\n    }\r\n\r\n    isValidSource(url_source, url_integration) {\r\n        return this.getHost(url_source) === this.getHost(url_integration);\r\n    }\r\n\r\n\r\n    getHost(url) {\r\n        let a = document.createElement('a');\r\n        a.href = url;\r\n        return a.hostname\r\n    }\r\n\r\n\r\n}\r\n\r\nexport default IntegrationConnect\r\n\r\n"],"names":["IntegrationConnect","constructor","requests","subscribers","timeout_sec","onmessage","e","console","log","origin","data","message","hasOwnProperty","handleResponse","handleRequest","window","addEventListener","attachEvent","setInterval","time","Date","getTime","id","request","success","payload","code","route","type","callback","push","send","parent","postMessage","JSON","parse","stringify","response","subscriber","error","sendRequest","_message","arguments","length","undefined","isValidSource","url_source","url_integration","getHost","url","a","document","createElement","href","hostname"],"sourceRoot":""}